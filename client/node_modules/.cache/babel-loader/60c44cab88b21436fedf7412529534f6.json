{"ast":null,"code":"import _slicedToArray from\"/Users/apple/Documents/work/git/nest-react/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React,{useState}from'react';import{useLazyQuery,useMutation}from\"@apollo/client\";import{LOGIN_USER,REGISTER_USER,USER_ME}from\"../../process/apollo/GqlData\";import{LoginForm}from\"../components/LoginForm\";import{Button,Card,Col,Container,Row}from\"react-bootstrap\";import{RegisterForm}from\"../components/RegisterForm\";import Auth from\"../../process/store/Auth\";var EFormState;(function(EFormState){EFormState[\"login\"]=\"login\";EFormState[\"register\"]=\"register\";})(EFormState||(EFormState={}));export var LoginPage=function LoginPage(){var auth=Auth.instance;var _useState=useState(EFormState.login),_useState2=_slicedToArray(_useState,2),formState=_useState2[0],setFormState=_useState2[1];var _useLazyQuery=useLazyQuery(USER_ME,{fetchPolicy:'no-cache',notifyOnNetworkStatusChange:true,onCompleted:function onCompleted(_ref){var me=_ref.me;auth.user=me;}}),_useLazyQuery2=_slicedToArray(_useLazyQuery,2),getCurrentUser=_useLazyQuery2[0],queryLoading=_useLazyQuery2[1].loading;var _useMutation=useMutation(LOGIN_USER,{errorPolicy:'all',notifyOnNetworkStatusChange:true,onCompleted:function onCompleted(data){if(data&&data.login){auth.token=data.login.token;getCurrentUser({variables:{}});}}}),_useMutation2=_slicedToArray(_useMutation,2),login=_useMutation2[0],loading=_useMutation2[1].loading;var _useMutation3=useMutation(REGISTER_USER,{errorPolicy:'all',notifyOnNetworkStatusChange:true,onCompleted:function onCompleted(data){debugger;if(data&&data.register){auth.logOut();auth.token=data.register.token;getCurrentUser({variables:{}});}}}),_useMutation4=_slicedToArray(_useMutation3,2),register=_useMutation4[0],regLoading=_useMutation4[1].loading;if(loading||queryLoading||regLoading){console.log(\"queries loading\");}return/*#__PURE__*/_jsx(Container,{fluid:true,children:/*#__PURE__*/_jsx(Row,{className:\"justify-content-center\",children:/*#__PURE__*/_jsx(Col,{sm:{span:8},md:{span:8},lg:{span:6},xl:{span:6},xs:12,children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(Card.Header,{children:formState===EFormState.login?'Login':'Register'}),/*#__PURE__*/_jsxs(Card.Body,{className:\"text-center\",children:[formState===EFormState.login?/*#__PURE__*/_jsx(LoginForm,{login:login}):/*#__PURE__*/_jsx(RegisterForm,{reg:register}),/*#__PURE__*/_jsx(\"div\",{className:\"pt-3\",children:formState===EFormState.login?/*#__PURE__*/_jsx(Button,{variant:\"link\",onClick:function onClick(){return setFormState(EFormState.register);},children:\"Register\"}):/*#__PURE__*/_jsx(Button,{variant:\"link\",onClick:function onClick(){return setFormState(EFormState.login);},children:\"Login\"})})]})]})})})});};","map":{"version":3,"sources":["/Users/apple/Documents/work/git/nest-react/client/src/ui/pages/Login.tsx"],"names":["React","useState","useLazyQuery","useMutation","LOGIN_USER","REGISTER_USER","USER_ME","LoginForm","Button","Card","Col","Container","Row","RegisterForm","Auth","EFormState","LoginPage","auth","instance","login","formState","setFormState","fetchPolicy","notifyOnNetworkStatusChange","onCompleted","me","user","getCurrentUser","queryLoading","loading","errorPolicy","data","token","variables","register","logOut","regLoading","console","log","span"],"mappings":"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","sourcesContent":["import React, {useState} from 'react';\nimport {useLazyQuery, useMutation} from \"@apollo/client\";\nimport {LOGIN_USER, REGISTER_USER, USER_ME} from \"../../process/apollo/GqlData\";\nimport {LoginForm} from \"../components/LoginForm\";\nimport {Button, Card, Col, Container, Row} from \"react-bootstrap\";\nimport {RegisterForm} from \"../components/RegisterForm\";\nimport Auth from \"../../process/store/Auth\";\n\nenum EFormState {\n\t'login' = 'login',\n\t'register' = 'register'\n}\n\nexport const LoginPage = () => {\n\n\tconst auth = Auth.instance;\n\n\tconst [formState, setFormState] = useState<EFormState>(EFormState.login)\n\n\tconst [getCurrentUser, { loading: queryLoading }] = useLazyQuery(USER_ME, {\n\t\tfetchPolicy: 'no-cache',\n\t\tnotifyOnNetworkStatusChange: true,\n\t\tonCompleted({ me }) {\n\t\t\tauth.user = me;\n\t\t}\n\t})\n\n\tconst [login, { loading }] = useMutation(LOGIN_USER, {\n\t\terrorPolicy: 'all',\n\t\tnotifyOnNetworkStatusChange: true,\n\t\tonCompleted(data) {\n\t\t\tif (data && data.login) {\n\t\t\t\tauth.token = data.login.token as string;\n\t\t\t\tgetCurrentUser({ variables: {}});\n\t\t\t}\n\t\t},\n\t});\n\n\tconst [register, { loading: regLoading }] = useMutation(REGISTER_USER, {\n\t\terrorPolicy: 'all',\n\t\tnotifyOnNetworkStatusChange: true,\n\t\tonCompleted(data) {\n\t\t\tdebugger;\n\t\t\tif (data && data.register) {\n\t\t\t\tauth.logOut();\n\t\t\t\tauth.token = data.register.token as string\n\t\t\t\tgetCurrentUser({ variables: {}});\n\t\t\t}\n\t\t},\n\t})\n\n\tif (loading || queryLoading || regLoading) {\n\t\tconsole.log(`queries loading`);\n\t}\n\n\treturn (\n\t\t<Container fluid>\n\t\t\t<Row className=\"justify-content-center\">\n\t\t\t\t<Col sm={{span: 8}} md={{span: 8}} lg={{span: 6}} xl={{span: 6}} xs={12}>\n\t\t\t\t\t<Card>\n\t\t\t\t\t\t<Card.Header>{formState === EFormState.login ? 'Login' : 'Register'}</Card.Header>\n\t\t\t\t\t\t<Card.Body className=\"text-center\">\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tformState === EFormState.login ?\n\t\t\t\t\t\t\t\t\t(<LoginForm login={login}/>) :\n\t\t\t\t\t\t\t\t\t(<RegisterForm reg={register}/>)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t<div className=\"pt-3\">\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tformState === EFormState.login ?\n\t\t\t\t\t\t\t\t\t<Button variant=\"link\" onClick={ () => setFormState(EFormState.register)} >Register</Button> :\n\t\t\t\t\t\t\t\t\t<Button variant=\"link\" onClick={ () => setFormState(EFormState.login)} >Login</Button>\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Card.Body>\n\t\t\t\t\t</Card>\n\t\t\t\t</Col>\n\t\t\t</Row>\n\t\t</Container>\n\t);\n};\n"]},"metadata":{},"sourceType":"module"}