{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/apple/Documents/work/git/nest-react/client/src/ui/pages/Login.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport { useLazyQuery, useMutation } from \"@apollo/client\";\nimport { LOGIN_USER, REGISTER_USER, USER_ME } from \"../../process/apollo/GqlData\";\nimport { LoginForm } from \"../components/LoginForm\";\nimport { Button, Card, Col, Container, Row } from \"react-bootstrap\";\nimport { RegisterForm } from \"../components/RegisterForm\";\nimport PersistentStorage from \"../../process/store/Storage\";\nimport { Constants } from \"../../process/helpers/Models\";\nimport { isLoggedInVar, loggedUserVar, tokenVar } from \"../../process/apollo/GqlClient\";\nvar EFormState;\n\n(function (EFormState) {\n  EFormState[\"login\"] = \"login\";\n  EFormState[\"register\"] = \"register\";\n})(EFormState || (EFormState = {}));\n\nconst storage = PersistentStorage.instance;\nexport const LoginPage = () => {\n  _s();\n\n  const [formState, setFormState] = useState(EFormState.login);\n  const [getCurrentUser, {\n    loading: queryLoading\n  }] = useLazyQuery(USER_ME, {\n    fetchPolicy: 'no-cache',\n    notifyOnNetworkStatusChange: true,\n\n    onCompleted({\n      me\n    }) {\n      storage.setItem(Constants.USER, me);\n      loggedUserVar(me);\n      isLoggedInVar(true);\n    }\n\n  });\n  const [login, {\n    loading\n  }] = useMutation(LOGIN_USER, {\n    errorPolicy: 'all',\n    notifyOnNetworkStatusChange: true,\n\n    onCompleted(data) {\n      if (data && data.login) {\n        storage.clear();\n        storage.setItem(Constants.TOKEN, data.login.token);\n        tokenVar(data.login.token);\n        getCurrentUser({\n          variables: {}\n        });\n      }\n    }\n\n  });\n  const [register, {\n    loading: regLoading\n  }] = useMutation(REGISTER_USER, {\n    errorPolicy: 'all',\n    notifyOnNetworkStatusChange: true,\n\n    onCompleted(data) {\n      debugger;\n\n      if (data && data.register) {\n        storage.clear();\n        storage.setItem(Constants.TOKEN, data.login.token);\n        tokenVar(data.login.token);\n        getCurrentUser({\n          variables: {}\n        });\n      }\n    }\n\n  });\n\n  if (loading || queryLoading || regLoading) {\n    console.log(`queries loading`);\n  }\n\n  return /*#__PURE__*/_jsxDEV(Container, {\n    fluid: true,\n    children: /*#__PURE__*/_jsxDEV(Row, {\n      className: \"justify-content-center\",\n      children: /*#__PURE__*/_jsxDEV(Col, {\n        sm: {\n          span: 8\n        },\n        md: {\n          span: 8\n        },\n        lg: {\n          span: 6\n        },\n        xl: {\n          span: 6\n        },\n        xs: 12,\n        children: /*#__PURE__*/_jsxDEV(Card, {\n          children: [/*#__PURE__*/_jsxDEV(Card.Header, {\n            children: formState === EFormState.login ? 'Login' : 'Register'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 69,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(Card.Body, {\n            className: \"text-center\",\n            children: [formState === EFormState.login ? /*#__PURE__*/_jsxDEV(LoginForm, {\n              login: login\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 73,\n              columnNumber: 11\n            }, this) : /*#__PURE__*/_jsxDEV(RegisterForm, {\n              reg: register\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 74,\n              columnNumber: 11\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pt-3\",\n              children: formState === EFormState.login ? /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"link\",\n                onClick: () => setFormState(EFormState.register),\n                children: \"Register\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 79,\n                columnNumber: 10\n              }, this) : /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"link\",\n                onClick: () => setFormState(EFormState.login),\n                children: \"Login\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 80,\n                columnNumber: 10\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 76,\n              columnNumber: 8\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 70,\n            columnNumber: 7\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 6\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 5\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 4\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 65,\n    columnNumber: 3\n  }, this);\n};\n\n_s(LoginPage, \"MDTuZhozhsHx2sDYuXJXipQ/Q5o=\", false, function () {\n  return [useLazyQuery, useMutation, useMutation];\n});\n\n_c = LoginPage;\n\nvar _c;\n\n$RefreshReg$(_c, \"LoginPage\");","map":{"version":3,"sources":["/Users/apple/Documents/work/git/nest-react/client/src/ui/pages/Login.tsx"],"names":["React","useState","useLazyQuery","useMutation","LOGIN_USER","REGISTER_USER","USER_ME","LoginForm","Button","Card","Col","Container","Row","RegisterForm","PersistentStorage","Constants","isLoggedInVar","loggedUserVar","tokenVar","EFormState","storage","instance","LoginPage","formState","setFormState","login","getCurrentUser","loading","queryLoading","fetchPolicy","notifyOnNetworkStatusChange","onCompleted","me","setItem","USER","errorPolicy","data","clear","TOKEN","token","variables","register","regLoading","console","log","span"],"mappings":"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","sourcesContent":["import React, {useState} from 'react';\nimport {useLazyQuery, useMutation} from \"@apollo/client\";\nimport {LOGIN_USER, REGISTER_USER, USER_ME} from \"../../process/apollo/GqlData\";\nimport {LoginForm} from \"../components/LoginForm\";\nimport {Button, Card, Col, Container, Row} from \"react-bootstrap\";\nimport {RegisterForm} from \"../components/RegisterForm\";\nimport Auth from \"../../process/store/Auth\";\nimport PersistentStorage from \"../../process/store/Storage\";\nimport {Constants} from \"../../process/helpers/Models\";\nimport {isLoggedInVar, loggedUserVar, tokenVar} from \"../../process/apollo/GqlClient\";\n\nenum EFormState {\n\t'login' = 'login',\n\t'register' = 'register'\n}\n\nconst storage = PersistentStorage.instance;\n\nexport const LoginPage = () => {\n\n\tconst [formState, setFormState] = useState<EFormState>(EFormState.login)\n\n\tconst [getCurrentUser, { loading: queryLoading }] = useLazyQuery(USER_ME, {\n\t\tfetchPolicy: 'no-cache',\n\t\tnotifyOnNetworkStatusChange: true,\n\t\tonCompleted({ me }) {\n\t\t\tstorage.setItem(Constants.USER, me);\n\t\t\tloggedUserVar(me);\n\t\t\tisLoggedInVar(true);\n\t\t}\n\t})\n\n\tconst [login, { loading }] = useMutation(LOGIN_USER, {\n\t\terrorPolicy: 'all',\n\t\tnotifyOnNetworkStatusChange: true,\n\t\tonCompleted(data) {\n\t\t\tif (data && data.login) {\n\t\t\t\tstorage.clear();\n\t\t\t\tstorage.setItem(Constants.TOKEN, data.login.token);\n\t\t\t\ttokenVar(data.login.token);\n\t\t\t\tgetCurrentUser({ variables: {}});\n\t\t\t}\n\t\t},\n\t});\n\n\tconst [register, { loading: regLoading }] = useMutation(REGISTER_USER, {\n\t\terrorPolicy: 'all',\n\t\tnotifyOnNetworkStatusChange: true,\n\t\tonCompleted(data) {\n\t\t\tdebugger;\n\t\t\tif (data && data.register) {\n\t\t\t\tstorage.clear();\n\t\t\t\tstorage.setItem(Constants.TOKEN, data.login.token);\n\t\t\t\ttokenVar(data.login.token);\n\t\t\t\tgetCurrentUser({ variables: {}});\n\t\t\t}\n\t\t},\n\t})\n\n\tif (loading || queryLoading || regLoading) {\n\t\tconsole.log(`queries loading`);\n\t}\n\n\treturn (\n\t\t<Container fluid>\n\t\t\t<Row className=\"justify-content-center\">\n\t\t\t\t<Col sm={{span: 8}} md={{span: 8}} lg={{span: 6}} xl={{span: 6}} xs={12}>\n\t\t\t\t\t<Card>\n\t\t\t\t\t\t<Card.Header>{formState === EFormState.login ? 'Login' : 'Register'}</Card.Header>\n\t\t\t\t\t\t<Card.Body className=\"text-center\">\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tformState === EFormState.login ?\n\t\t\t\t\t\t\t\t\t(<LoginForm login={login}/>) :\n\t\t\t\t\t\t\t\t\t(<RegisterForm reg={register}/>)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t<div className=\"pt-3\">\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tformState === EFormState.login ?\n\t\t\t\t\t\t\t\t\t<Button variant=\"link\" onClick={ () => setFormState(EFormState.register)} >Register</Button> :\n\t\t\t\t\t\t\t\t\t<Button variant=\"link\" onClick={ () => setFormState(EFormState.login)} >Login</Button>\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Card.Body>\n\t\t\t\t\t</Card>\n\t\t\t\t</Col>\n\t\t\t</Row>\n\t\t</Container>\n\t);\n};\n"]},"metadata":{},"sourceType":"module"}