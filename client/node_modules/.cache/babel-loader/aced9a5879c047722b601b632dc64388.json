{"ast":null,"code":"import _slicedToArray from\"/Users/apple/Documents/work/git/nest-react/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React,{useState}from'react';import{useLazyQuery,useMutation}from\"@apollo/client\";import{LOGIN_USER,REGISTER_USER,USER_ME}from\"../../process/apollo/GqlData\";import{LoginForm}from\"../components/LoginForm\";import{Button,Card,Col,Container,Row}from\"react-bootstrap\";import{AuthService}from\"../../process/services/AuthService\";import{RegisterForm}from\"../components/RegisterForm\";var EFormState;(function(EFormState){EFormState[\"login\"]=\"login\";EFormState[\"register\"]=\"register\";})(EFormState||(EFormState={}));export var LoginPage=function LoginPage(){var _useState=useState(EFormState.login),_useState2=_slicedToArray(_useState,2),formState=_useState2[0],setFormState=_useState2[1];var _useLazyQuery=useLazyQuery(USER_ME,{fetchPolicy:'no-cache',notifyOnNetworkStatusChange:true,onCompleted:function onCompleted(_ref){var me=_ref.me;AuthService.setMe(me);AuthService.setLoggedId(true);}}),_useLazyQuery2=_slicedToArray(_useLazyQuery,2),getCurrentUser=_useLazyQuery2[0],queryLoading=_useLazyQuery2[1].loading;var _useMutation=useMutation(LOGIN_USER,{errorPolicy:'all',notifyOnNetworkStatusChange:true,onCompleted:function onCompleted(data){if(data&&data.login){AuthService.setToken(data.login.token);getCurrentUser({variables:{}});}}}),_useMutation2=_slicedToArray(_useMutation,2),login=_useMutation2[0],loading=_useMutation2[1].loading;var _useMutation3=useMutation(REGISTER_USER,{errorPolicy:'all',notifyOnNetworkStatusChange:true,onCompleted:function onCompleted(data){debugger;if(data&&data.register){AuthService.logOut();AuthService.setToken(data.register.token);getCurrentUser({variables:{}});}}}),_useMutation4=_slicedToArray(_useMutation3,2),register=_useMutation4[0],regLoading=_useMutation4[1].loading;if(loading||queryLoading||regLoading){console.log(\"queries loading\");}return/*#__PURE__*/_jsx(Container,{fluid:true,children:/*#__PURE__*/_jsx(Row,{className:\"justify-content-center\",children:/*#__PURE__*/_jsx(Col,{sm:{span:8},md:{span:8},lg:{span:6},xl:{span:6},xs:12,children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(Card.Header,{children:formState===EFormState.login?'Login':'Register'}),/*#__PURE__*/_jsxs(Card.Body,{className:\"text-center\",children:[formState===EFormState.login?/*#__PURE__*/_jsx(LoginForm,{login:login}):/*#__PURE__*/_jsx(RegisterForm,{reg:register}),/*#__PURE__*/_jsx(\"div\",{className:\"pt-3\",children:formState===EFormState.login?/*#__PURE__*/_jsx(Button,{variant:\"link\",onClick:function onClick(){return setFormState(EFormState.register);},children:\"Register\"}):/*#__PURE__*/_jsx(Button,{variant:\"link\",onClick:function onClick(){return setFormState(EFormState.login);},children:\"Login\"})})]})]})})})});};","map":{"version":3,"sources":["/Users/apple/Documents/work/git/nest-react/client/src/ui/pages/Login.tsx"],"names":["React","useState","useLazyQuery","useMutation","LOGIN_USER","REGISTER_USER","USER_ME","LoginForm","Button","Card","Col","Container","Row","AuthService","RegisterForm","EFormState","LoginPage","login","formState","setFormState","fetchPolicy","notifyOnNetworkStatusChange","onCompleted","me","setMe","setLoggedId","getCurrentUser","queryLoading","loading","errorPolicy","data","setToken","token","variables","register","logOut","regLoading","console","log","span"],"mappings":"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","sourcesContent":["import React, {useState} from 'react';\nimport {useLazyQuery, useMutation} from \"@apollo/client\";\nimport {LOGIN_USER, REGISTER_USER, USER_ME} from \"../../process/apollo/GqlData\";\nimport {LoginForm} from \"../components/LoginForm\";\nimport {Button, Card, Col, Container, Row} from \"react-bootstrap\";\nimport {AuthService} from \"../../process/services/AuthService\";\nimport {RegisterForm} from \"../components/RegisterForm\";\n\nenum EFormState {\n\t'login' = 'login',\n\t'register' = 'register'\n}\n\nexport const LoginPage = () => {\n\n\tconst [formState, setFormState] = useState<EFormState>(EFormState.login)\n\n\tconst [getCurrentUser, { loading: queryLoading }] = useLazyQuery(USER_ME, {\n\t\tfetchPolicy: 'no-cache',\n\t\tnotifyOnNetworkStatusChange: true,\n\t\tonCompleted({ me }) {\n\t\t\tAuthService.setMe(me);\n\t\t\tAuthService.setLoggedId(true);\n\t\t}\n\t})\n\n\tconst [login, { loading }] = useMutation(LOGIN_USER, {\n\t\terrorPolicy: 'all',\n\t\tnotifyOnNetworkStatusChange: true,\n\t\tonCompleted(data) {\n\t\t\tif (data && data.login) {\n\t\t\t\tAuthService.setToken(data.login.token as string)\n\t\t\t\tgetCurrentUser({ variables: {}});\n\t\t\t}\n\t\t},\n\t});\n\n\tconst [register, { loading: regLoading }] = useMutation(REGISTER_USER, {\n\t\terrorPolicy: 'all',\n\t\tnotifyOnNetworkStatusChange: true,\n\t\tonCompleted(data) {\n\t\t\tdebugger;\n\t\t\tif (data && data.register) {\n\t\t\t\tAuthService.logOut();\n\t\t\t\tAuthService.setToken(data.register.token as string)\n\t\t\t\tgetCurrentUser({ variables: {}});\n\t\t\t}\n\t\t},\n\t})\n\n\tif (loading || queryLoading || regLoading) {\n\t\tconsole.log(`queries loading`);\n\t}\n\n\treturn (\n\t\t<Container fluid>\n\t\t\t<Row className=\"justify-content-center\">\n\t\t\t\t<Col sm={{span: 8}} md={{span: 8}} lg={{span: 6}} xl={{span: 6}} xs={12}>\n\t\t\t\t\t<Card>\n\t\t\t\t\t\t<Card.Header>{formState === EFormState.login ? 'Login' : 'Register'}</Card.Header>\n\t\t\t\t\t\t<Card.Body className=\"text-center\">\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tformState === EFormState.login ?\n\t\t\t\t\t\t\t\t\t(<LoginForm login={login}/>) :\n\t\t\t\t\t\t\t\t\t(<RegisterForm reg={register}/>)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t<div className=\"pt-3\">\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tformState === EFormState.login ?\n\t\t\t\t\t\t\t\t\t<Button variant=\"link\" onClick={ () => setFormState(EFormState.register)} >Register</Button> :\n\t\t\t\t\t\t\t\t\t<Button variant=\"link\" onClick={ () => setFormState(EFormState.login)} >Login</Button>\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Card.Body>\n\t\t\t\t\t</Card>\n\t\t\t\t</Col>\n\t\t\t</Row>\n\t\t</Container>\n\t);\n};\n"]},"metadata":{},"sourceType":"module"}